<div class="bg-admin-gray-light min-h-screen">
  <!-- Header -->
  <div class="bg-admin-white border-b border-admin-gray-medium">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-admin-gray-dark">CRM Dashboard</h1>
            <p class="mt-1 text-sm text-admin-gray">Complete customer relationship management overview</p>
          </div>
          <div class="flex space-x-3">
            <%= link_to admin_leads_path, class: "bg-admin-primary text-admin-white px-4 py-2 rounded-lg hover:bg-admin-primary-dark transition-colors" do %>
              <i class="fa fa-plus mr-2"></i>New Lead
            <% end %>
            <%= link_to admin_deals_path, class: "bg-admin-green text-admin-white px-4 py-2 rounded-lg hover:bg-admin-green-dark transition-colors" do %>
              <i class="fa fa-handshake mr-2"></i>Manage Deals
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Key Metrics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- Total Leads -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-admin-gray">Total Leads</p>
            <p class="text-3xl font-bold text-admin-gray-dark"><%= @leads_count %></p>
            <p class="text-sm text-admin-green">+<%= @new_leads_this_month %> this month</p>
          </div>
          <div class="w-12 h-12 bg-admin-blue-light rounded-lg flex items-center justify-center">
            <i class="fa fa-users text-admin-blue text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Active Deals -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-admin-gray">Active Deals</p>
            <p class="text-3xl font-bold text-admin-gray-dark"><%= @active_deals.count %></p>
            <p class="text-sm text-admin-green">£<%= number_with_delimiter(@pipeline_value, delimiter: ',') %> pipeline</p>
          </div>
          <div class="w-12 h-12 bg-admin-green-light rounded-lg flex items-center justify-center">
            <i class="fa fa-handshake text-admin-green text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Monthly Revenue -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-admin-gray">Monthly Revenue</p>
            <p class="text-3xl font-bold text-admin-gray-dark">£<%= number_with_delimiter(@monthly_revenue, delimiter: ',') %></p>
            <p class="text-sm text-admin-gray"><%= @deals_closed_won.count %> deals closed</p>
          </div>
          <div class="w-12 h-12 bg-admin-yellow-light rounded-lg flex items-center justify-center">
            <i class="fa fa-pound-sign text-admin-yellow text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Conversion Rate -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-admin-gray">Conversion Rate</p>
            <p class="text-3xl font-bold text-admin-gray-dark"><%= @conversion_rate %>%</p>
            <p class="text-sm text-admin-gray">Lead to Contact</p>
          </div>
          <div class="w-12 h-12 bg-admin-purple-light rounded-lg flex items-center justify-center">
            <i class="fa fa-chart-line text-admin-purple text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Pipeline Overview -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Sales Pipeline -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-admin-gray-dark">Sales Pipeline</h3>
          <span class="text-sm text-admin-gray">Weighted Value: £<%= number_with_delimiter(@weighted_pipeline, delimiter: ',') %></span>
        </div>
        
        <div class="space-y-4">
          <% %w[prospecting qualification proposal negotiation].each do |stage| %>
            <% deals_count = @deals_by_stage[stage] || 0 %>
            <% stage_value = @stage_values[stage] || 0 %>
            <div class="flex items-center justify-between p-4 bg-admin-gray-lightest rounded-lg">
              <div class="flex items-center space-x-3">
                <div class="w-3 h-3 rounded-full bg-admin-<%= stage == 'prospecting' ? 'blue' : stage == 'qualification' ? 'yellow' : stage == 'proposal' ? 'orange' : 'green' %>"></div>
                <div>
                  <p class="font-medium text-admin-gray-dark"><%= stage.humanize %></p>
                  <p class="text-sm text-admin-gray"><%= deals_count %> deals</p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-semibold text-admin-gray-dark">£<%= number_with_delimiter(stage_value, delimiter: ',') %></p>
              </div>
            </div>
          <% end %>
        </div>
        
        <div class="mt-4 pt-4 border-t border-admin-gray-light">
          <div class="flex justify-between text-sm">
            <span class="text-admin-gray">Close Rate This Month:</span>
            <span class="font-semibold text-admin-<%= @deal_close_rate > 50 ? 'green' : @deal_close_rate > 25 ? 'yellow' : 'red' %>"><%= @deal_close_rate %>%</span>
          </div>
        </div>
      </div>

      <!-- Lead Scoring -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <h3 class="text-lg font-semibold text-admin-gray-dark mb-6">Lead Intelligence</h3>
        
        <div class="space-y-4">
          <div class="flex items-center justify-between p-4 bg-admin-green-lightest rounded-lg">
            <div>
              <p class="font-medium text-admin-gray-dark">High Score Leads</p>
              <p class="text-sm text-admin-gray">Score 70+ ready for sales</p>
            </div>
            <span class="text-2xl font-bold text-admin-green"><%= @high_score_leads %></span>
          </div>
          
          <div class="flex items-center justify-between p-4 bg-admin-blue-lightest rounded-lg">
            <div>
              <p class="font-medium text-admin-gray-dark">Qualified Leads</p>
              <p class="text-sm text-admin-gray">MQL & SQL combined</p>
            </div>
            <span class="text-2xl font-bold text-admin-blue"><%= @qualified_leads %></span>
          </div>
          
          <div class="flex items-center justify-between p-4 bg-admin-purple-lightest rounded-lg">
            <div>
              <p class="font-medium text-admin-gray-dark">Customers</p>
              <p class="text-sm text-admin-gray">Converted contacts</p>
            </div>
            <span class="text-2xl font-bold text-admin-purple"><%= @customers %></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Activity & Task Overview -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
      <!-- Recent Activities -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-admin-gray-dark">Recent Activities</h3>
          <%= link_to admin_activities_path, class: "text-admin-primary hover:text-admin-primary-dark text-sm" do %>
            View all
          <% end %>
        </div>
        
        <div class="space-y-3">
          <% @recent_activities.each do |activity| %>
            <div class="flex items-start space-x-3 p-3 hover:bg-admin-gray-lightest rounded-lg transition-colors">
              <div class="w-8 h-8 bg-admin-<%= activity.activity_type == 'call' ? 'blue' : activity.activity_type == 'email' ? 'green' : activity.activity_type == 'meeting' ? 'purple' : 'gray' %>-light rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fa <%= case activity.activity_type
                  when 'call' then 'fa-phone'
                  when 'email' then 'fa-envelope'
                  when 'meeting' then 'fa-calendar'
                  else 'fa-circle'
                end %> text-admin-<%= activity.activity_type == 'call' ? 'blue' : activity.activity_type == 'email' ? 'green' : activity.activity_type == 'meeting' ? 'purple' : 'gray' %> text-xs"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-admin-gray-dark truncate"><%= activity.title %></p>
                <p class="text-xs text-admin-gray">
                  <%= activity.related_record_name %> • <%= time_ago_in_words(activity.activity_date) %> ago
                </p>
              </div>
            </div>
          <% end %>
        </div>
        
        <div class="mt-4 pt-4 border-t border-admin-gray-light text-center">
          <p class="text-sm text-admin-gray">
            <span class="font-semibold"><%= @activities_this_week %></span> activities this week
          </p>
        </div>
      </div>

      <!-- Task Management -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-admin-gray-dark">Task Overview</h3>
          <%= link_to admin_tasks_path, class: "text-admin-primary hover:text-admin-primary-dark text-sm" do %>
            Manage tasks
          <% end %>
        </div>
        
        <div class="space-y-4">
          <div class="flex items-center justify-between p-3 bg-admin-red-lightest rounded-lg">
            <div class="flex items-center space-x-2">
              <i class="fa fa-exclamation-triangle text-admin-red"></i>
              <span class="text-sm font-medium text-admin-gray-dark">Overdue</span>
            </div>
            <span class="text-lg font-bold text-admin-red"><%= @overdue_tasks %></span>
          </div>
          
          <div class="flex items-center justify-between p-3 bg-admin-yellow-lightest rounded-lg">
            <div class="flex items-center space-x-2">
              <i class="fa fa-clock text-admin-yellow"></i>
              <span class="text-sm font-medium text-admin-gray-dark">Due Today</span>
            </div>
            <span class="text-lg font-bold text-admin-yellow"><%= @tasks_due_today %></span>
          </div>
          
          <div class="flex items-center justify-between p-3 bg-admin-blue-lightest rounded-lg">
            <div class="flex items-center space-x-2">
              <i class="fa fa-tasks text-admin-blue"></i>
              <span class="text-sm font-medium text-admin-gray-dark">Open Tasks</span>
            </div>
            <span class="text-lg font-bold text-admin-blue"><%= @open_tasks %></span>
          </div>
        </div>
        
        <div class="mt-4">
          <h4 class="text-sm font-medium text-admin-gray-dark mb-2">Recent Tasks</h4>
          <div class="space-y-2">
            <% @recent_tasks.each do |task| %>
              <div class="flex items-center space-x-2 p-2 hover:bg-admin-gray-lightest rounded">
                <div class="w-2 h-2 rounded-full bg-admin-<%= task.priority == 'urgent' ? 'red' : task.priority == 'high' ? 'orange' : task.priority == 'medium' ? 'yellow' : 'green' %>"></div>
                <span class="text-xs text-admin-gray-dark truncate flex-1"><%= task.title %></span>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <h3 class="text-lg font-semibold text-admin-gray-dark mb-4">Performance Metrics</h3>
        
        <div class="space-y-4">
          <div>
            <div class="flex justify-between items-center mb-1">
              <span class="text-sm text-admin-gray">Average Deal Size</span>
              <span class="text-sm font-semibold text-admin-gray-dark">£<%= number_with_delimiter(@average_deal_size, delimiter: ',') %></span>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between items-center mb-1">
              <span class="text-sm text-admin-gray">Deal Win Rate</span>
              <span class="text-sm font-semibold text-admin-<%= @deal_close_rate > 50 ? 'green' : @deal_close_rate > 25 ? 'yellow' : 'red' %>"><%= @deal_close_rate %>%</span>
            </div>
            <div class="w-full bg-admin-gray-light rounded-full h-2">
              <div class="bg-admin-<%= @deal_close_rate > 50 ? 'green' : @deal_close_rate > 25 ? 'yellow' : 'red' %> h-2 rounded-full" style="width: <%= @deal_close_rate %>%"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between items-center mb-1">
              <span class="text-sm text-admin-gray">Lead Conversion</span>
              <span class="text-sm font-semibold text-admin-<%= @conversion_rate > 30 ? 'green' : @conversion_rate > 15 ? 'yellow' : 'red' %>"><%= @conversion_rate %>%</span>
            </div>
            <div class="w-full bg-admin-gray-light rounded-full h-2">
              <div class="bg-admin-<%= @conversion_rate > 30 ? 'green' : @conversion_rate > 15 ? 'yellow' : 'red' %> h-2 rounded-full" style="width: <%= [@conversion_rate, 100].min %>%"></div>
            </div>
          </div>
        </div>
        
        <div class="mt-6 pt-4 border-t border-admin-gray-light">
          <h4 class="text-sm font-medium text-admin-gray-dark mb-3">Quick Actions</h4>
          <div class="space-y-2">
            <%= link_to admin_leads_path, class: "block w-full text-left px-3 py-2 text-sm text-admin-gray-dark hover:bg-admin-gray-lightest rounded transition-colors" do %>
              <i class="fa fa-plus mr-2"></i>Add New Lead
            <% end %>
            <%= link_to admin_deals_path, class: "block w-full text-left px-3 py-2 text-sm text-admin-gray-dark hover:bg-admin-gray-lightest rounded transition-colors" do %>
              <i class="fa fa-handshake mr-2"></i>Create Deal
            <% end %>
            <%= link_to admin_activities_path, class: "block w-full text-left px-3 py-2 text-sm text-admin-gray-dark hover:bg-admin-gray-lightest rounded transition-colors" do %>
              <i class="fa fa-plus mr-2"></i>Log Activity
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Records -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Recent Leads -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-admin-gray-dark">Recent Leads</h3>
          <%= link_to admin_leads_path, class: "text-admin-primary hover:text-admin-primary-dark text-sm" do %>
            View all
          <% end %>
        </div>
        
        <div class="space-y-3">
          <% @recent_leads.each do |lead| %>
            <div class="flex items-center justify-between p-3 hover:bg-admin-gray-lightest rounded-lg transition-colors">
              <div>
                <p class="text-sm font-medium text-admin-gray-dark"><%= lead.full_name %></p>
                <p class="text-xs text-admin-gray"><%= lead.company || lead.email %></p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-admin-<%= lead.lead_score >= 70 ? 'green' : lead.lead_score >= 40 ? 'yellow' : 'gray' %>-light text-admin-<%= lead.lead_score >= 70 ? 'green' : lead.lead_score >= 40 ? 'yellow' : 'gray' %>">
                  <%= lead.lead_score %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Recent Contacts -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-admin-gray-dark">Recent Contacts</h3>
          <%= link_to admin_contacts_path, class: "text-admin-primary hover:text-admin-primary-dark text-sm" do %>
            View all
          <% end %>
        </div>
        
        <div class="space-y-3">
          <% @recent_contacts.each do |contact| %>
            <div class="flex items-center justify-between p-3 hover:bg-admin-gray-lightest rounded-lg transition-colors">
              <div>
                <p class="text-sm font-medium text-admin-gray-dark"><%= contact.full_name %></p>
                <p class="text-xs text-admin-gray"><%= contact.company || contact.job_title || contact.email %></p>
              </div>
              <div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-admin-<%= contact.customer? ? 'green' : contact.lifecycle_stage.include?('qualified') ? 'blue' : 'gray' %>-light text-admin-<%= contact.customer? ? 'green' : contact.lifecycle_stage.include?('qualified') ? 'blue' : 'gray' %>">
                  <%= contact.lifecycle_stage.humanize %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Recent Deals -->
      <div class="bg-admin-white rounded-lg shadow p-6 border border-admin-gray-light">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-admin-gray-dark">Recent Deals</h3>
          <%= link_to admin_deals_path, class: "text-admin-primary hover:text-admin-primary-dark text-sm" do %>
            View all
          <% end %>
        </div>
        
        <div class="space-y-3">
          <% @recent_deals.each do |deal| %>
            <div class="flex items-center justify-between p-3 hover:bg-admin-gray-lightest rounded-lg transition-colors">
              <div>
                <p class="text-sm font-medium text-admin-gray-dark"><%= deal.name %></p>
                <p class="text-xs text-admin-gray"><%= deal.contact.display_name %></p>
              </div>
              <div class="text-right">
                <p class="text-sm font-semibold text-admin-gray-dark">£<%= number_with_delimiter(deal.amount, delimiter: ',') %></p>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium <%= deal.stage_color %>">
                  <%= deal.stage.humanize %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>